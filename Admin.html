<!DOCTYPE html>
<html>
<head>
<title>Brahmastra Admin Panel</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white p-4 pb-20">

<h1 class="text-3xl font-bold text-purple-400 mb-4 text-center">ğŸ›¡ï¸ Brahmastra Admin</h1>

<div class="bg-slate-900 p-4 rounded-xl border border-slate-800 mb-4 shadow-lg">
  <div class="flex justify-between items-center mb-4">
    <h2 class="font-bold text-xl text-purple-300" id="formTitle">â• Add New Product</h2>
    <button onclick="resetForm()" id="cancelBtn" class="hidden text-xs bg-gray-700 px-2 py-1 rounded hover:bg-gray-600">Cancel Edit</button>
  </div>

  <input id="pTitle" placeholder="Game Title" class="w-full mb-3 p-3 bg-black border border-slate-700 rounded text-white focus:border-purple-500 outline-none">
  
  <div class="flex gap-2 mb-3">
    <input id="pPrice" placeholder="Price (â‚¹)" type="number" class="w-1/2 p-3 bg-black border border-slate-700 rounded text-white focus:border-purple-500 outline-none">
    <input id="pImg" placeholder="Image URL" class="w-1/2 p-3 bg-black border border-slate-700 rounded text-white focus:border-purple-500 outline-none">
  </div>

  <p class="text-xs text-gray-400 mb-1">Or Upload from Gallery:</p>
  <input type="file" id="imgFile" accept="image/*" class="w-full mb-3 p-2 bg-slate-800 rounded cursor-pointer" onchange="loadFromGallery(event)">

  <img id="previewImg" class="w-full h-40 object-cover rounded hidden mb-3 border border-purple-500/50">

  <input id="pVideo" placeholder="YouTube Embed URL" class="w-full mb-3 p-3 bg-black border border-slate-700 rounded text-white focus:border-purple-500 outline-none">
  <textarea id="pDesc" placeholder="Description" rows="3" class="w-full mb-3 p-3 bg-black border border-slate-700 rounded text-white focus:border-purple-500 outline-none"></textarea>

  <button id="submitBtn" onclick="saveProduct()" class="bg-green-600 hover:bg-green-700 transition font-bold px-4 py-3 rounded w-full text-lg shadow-lg shadow-green-900/50">
    âœ… Save Product
  </button>
</div>

<div class="grid grid-cols-2 gap-4 mb-4">
  <div class="bg-slate-900 p-4 rounded-xl border border-slate-800">
    <h2 class="font-bold text-lg mb-2 text-pink-400">ğŸ’¸ Global Discount</h2>
    <input id="discount" placeholder="Example: 10" type="number" class="w-full mb-2 p-2 bg-black border border-slate-700 rounded">
    <button onclick="setDiscount()" class="bg-pink-600 hover:bg-pink-700 w-full py-1 rounded font-bold text-sm">Apply %</button>
  </div>

  <div class="bg-slate-900 p-4 rounded-xl border border-slate-800">
    <h2 class="font-bold text-lg mb-2 text-blue-400">ğŸ Coupon Code</h2>
    <input id="couponCode" placeholder="Code (e.g. DIWALI)" class="w-full mb-2 p-2 bg-black border border-slate-700 rounded">
    <input id="couponOff" placeholder="Off %" type="number" class="w-full mb-2 p-2 bg-black border border-slate-700 rounded">
    <button onclick="saveCoupon()" class="bg-blue-600 hover:bg-blue-700 w-full py-1 rounded font-bold text-sm">Set Coupon</button>
  </div>
</div>

<div class="bg-slate-900 p-4 rounded-xl border border-slate-800">
  <h2 class="font-bold text-xl mb-4 flex items-center gap-2">
    ğŸ“¦ All Products <span id="countBadge" class="bg-purple-600 text-xs px-2 py-1 rounded-full">0</span>
  </h2>
  <div id="list" class="space-y-3"></div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
let discountValue = localStorage.getItem("discount") || 0;
let coupon = JSON.parse(localStorage.getItem("coupon")) || null;
let editingId = null; // Track kar raha hai ki hum naya bana rahe hain ya edit kar rahe hain

/* Gallery Load */
function loadFromGallery(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(){
    previewImg.src = reader.result;
    previewImg.classList.remove("hidden");
    pImg.value = reader.result; 
  };
  reader.readAsDataURL(file);
}

/* Save OR Update Product */
function saveProduct(){
  if(!pTitle.value || !pPrice.value){
    alert("Please enter Title and Price!");
    return;
  }

  // UPDATE MODE
  if(editingId != null){
    const index = products.findIndex(p => p.id === editingId);
    if(index > -1){
      products[index].title = pTitle.value;
      products[index].price = +pPrice.value;
      products[index].img = pImg.value;
      products[index].video = pVideo.value;
      products[index].desc = pDesc.value;
      alert("âœ… Product Updated Successfully!");
    }
  } 
  // ADD NEW MODE
  else {
    let p = {
      id: Date.now(),
      title: pTitle.value,
      price: +pPrice.value,
      img: pImg.value,
      video: pVideo.value,
      desc: pDesc.value
    };
    products.push(p);
    alert("âœ… New Product Added!");
  }

  localStorage.setItem("products", JSON.stringify(products));
  resetForm();
  render();
}

/* Edit Mode On Karenge */
function edit(id){
  const p = products.find(x => x.id === id);
  if(!p) return;

  // Form bharna
  pTitle.value = p.title;
  pPrice.value = p.price;
  pImg.value = p.img;
  pVideo.value = p.video;
  pDesc.value = p.desc;
  
  if(p.img){
    previewImg.src = p.img;
    previewImg.classList.remove("hidden");
  }

  // State Change
  editingId = id;
  document.getElementById("formTitle").innerText = "âœï¸ Edit Product";
  document.getElementById("formTitle").className = "font-bold text-xl text-yellow-400";
  
  const btn = document.getElementById("submitBtn");
  btn.innerText = "ğŸ”„ Update Product";
  btn.className = "bg-yellow-500 hover:bg-yellow-600 transition font-bold px-4 py-3 rounded w-full text-lg text-black shadow-lg";

  document.getElementById("cancelBtn").classList.remove("hidden");

  // Scroll to top
  window.scrollTo({top: 0, behavior: 'smooth'});
}

/* Reset Form (Cancel or After Save) */
function resetForm(){
  pTitle.value = "";
  pPrice.value = "";
  pImg.value = "";
  pVideo.value = "";
  pDesc.value = "";
  imgFile.value = "";
  previewImg.classList.add("hidden");
  
  editingId = null;
  document.getElementById("formTitle").innerText = "â• Add New Product";
  document.getElementById("formTitle").className = "font-bold text-xl text-purple-300";
  
  const btn = document.getElementById("submitBtn");
  btn.innerText = "âœ… Save Product";
  btn.className = "bg-green-600 hover:bg-green-700 transition font-bold px-4 py-3 rounded w-full text-lg shadow-lg shadow-green-900/50";

  document.getElementById("cancelBtn").classList.add("hidden");
}

/* Delete */
function del(id){
  if(confirm("Are you sure you want to delete this game?")){
    products = products.filter(x => x.id != id);
    localStorage.setItem("products", JSON.stringify(products));
    render();
    if(editingId === id) resetForm(); // Agar wahi edit kar rahe the jo delete kiya
  }
}

/* Discount & Coupon Functions (Same as before) */
function setDiscount(){
  localStorage.setItem("discount", discount.value);
  alert("Discount Set!");
}
function saveCoupon(){
  let c={code:couponCode.value, off:couponOff.value};
  localStorage.setItem("coupon", JSON.stringify(c));
  alert("Coupon Saved!");
}

/* Render List */
function render(){
  document.getElementById("countBadge").innerText = products.length;
  list.innerHTML = products.map(p => `
    <div class="flex items-start gap-3 bg-black/40 border border-slate-700 p-3 rounded-lg hover:border-purple-500 transition">
      <img src="${p.img || 'https://via.placeholder.com/100'}" class="w-20 h-20 object-cover rounded bg-slate-800">
      <div class="flex-1">
        <div class="flex justify-between items-start">
            <h3 class="font-bold text-lg text-white">${p.title}</h3>
            <span class="text-green-400 font-mono font-bold">â‚¹${p.price}</span>
        </div>
        <p class="text-xs text-gray-400 truncate w-48">${p.desc || 'No desc'}</p>
        
        <div class="flex gap-2 mt-3">
          <button onclick="edit(${p.id})" class="flex-1 bg-yellow-600 hover:bg-yellow-500 text-white text-sm py-1.5 rounded font-bold transition">
            âœï¸ Edit
          </button>
          <button onclick="del(${p.id})" class="flex-1 bg-red-600 hover:bg-red-500 text-white text-sm py-1.5 rounded font-bold transition">
            ğŸ—‘ Delete
          </button>
        </div>
      </div>
    </div>
  `).reverse().join(""); // Newest first
}

// Load initial values
discount.value = discountValue;
if(coupon){
  couponCode.value = coupon.code;
  couponOff.value = coupon.off;
}

render();
</script>
</body>
</html>
