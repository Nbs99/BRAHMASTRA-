<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Brahmastra Game Store Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<style>
body{margin:0;background:#0f0f12;color:white;font-family:'Segoe UI',sans-serif}
.glass{background:rgba(30,30,40,.6);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.08)}
.card-hover{transition:.3s}
.card-hover:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(124,58,237,.2)}
.slider-container{height:220px;border-radius:16px;overflow:hidden;position:relative}
.slide{position:absolute;inset:0;opacity:0;transition:1s;object-fit:cover;width:100%;height:100%}
.slide.active{opacity:1}
.float-cart{position:fixed;bottom:20px;right:20px;animation:bounce 2s infinite}
@keyframes bounce{0%,100%{transform:0}50%{transform:translateY(-10px)}}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#10b981;color:#fff;padding:10px 20px;border-radius:40px;font-weight:bold;opacity:0;transition:.3s;z-index:999}
.toast.show{top:80px;opacity:1}
</style>
</head>
<body class="pb-24">

<nav class="sticky top-0 z-50 glass px-4 py-3 flex justify-between items-center">
 <h1 class="text-xl font-bold text-purple-400">BRAHMASTRA</h1>
 <div class="relative cursor-pointer" onclick="toggleCart()">
  <i class="ri-shopping-cart-2-line text-2xl"></i>
  <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-xs w-5 h-5 flex items-center justify-center rounded-full">0</span>
 </div>
</nav>

<!-- SLIDER -->
<div class="px-4 mt-4 slider-container">
 <img src="https://wallpapers.com/images/hd/grand-theft-auto-v-pc-game-poster-9z6894033j54128q.jpg" class="slide active">
 <img src="https://wallpapers.com/images/hd/cyberpunk-2077-yellow-background-49l9j5z15l0j5z15.jpg" class="slide">
</div>

<!-- SEARCH -->
<div class="px-4 mt-4">
 <input id="searchInput" oninput="renderGames()" placeholder="Search games..."
  class="w-full bg-[#1c1c24] p-3 rounded-xl border border-gray-700">
</div>

<!-- GRID -->
<div class="px-4 mt-4 grid grid-cols-2 md:grid-cols-4 gap-4" id="gamesGrid"></div>

<button onclick="toggleCart()" class="float-cart bg-purple-600 w-14 h-14 rounded-full flex items-center justify-center text-2xl">
 <i class="ri-shopping-bag-3-fill"></i>
</button>

<!-- CART -->
<div id="cartDrawer" class="fixed inset-y-0 right-0 w-full sm:w-[350px] bg-[#15151a] transform translate-x-full transition duration-300 z-[100] flex flex-col border-l border-gray-800">
 <div class="p-4 flex justify-between border-b border-gray-800">
  <b>My Cart</b>
  <button onclick="toggleCart()">✖</button>
 </div>
 <div id="cartItems" class="flex-1 p-4 space-y-3 overflow-y-auto text-sm text-gray-400">Cart Empty</div>
 <div class="p-4 border-t border-gray-800">
  <p class="font-bold mb-2">Total: <span id="cartTotal" class="text-green-400">₹0</span></p>
  <input id="couponInput" placeholder="Coupon Code" class="w-full mb-2 p-2 bg-black border border-gray-700">
  <button onclick="applyCoupon()" class="bg-purple-600 w-full p-2 rounded mb-2">Apply Coupon</button>
  <button onclick="checkout()" class="bg-green-600 w-full p-2 rounded">Checkout WhatsApp</button>
 </div>
</div>

<!-- MODAL -->
<div id="gameModal" class="fixed inset-0 bg-black/80 hidden z-[200] flex items-center justify-center p-4" onclick="closeModal()">
 <div class="bg-[#15151a] w-full max-w-lg rounded-xl p-4" onclick="event.stopPropagation()">
  <button onclick="closeModal()" class="float-right">✖</button>
  <iframe id="mVideo" class="w-full h-48 mb-2"></iframe>
  <h2 id="mTitle" class="text-xl font-bold"></h2>
  <p id="mDesc" class="text-gray-400 text-sm my-2"></p>
  <p id="mPrice" class="text-green-400 font-bold text-lg mb-3"></p>
  <button id="mAddToCart" class="bg-purple-600 w-full p-2 rounded mb-2">Add to Cart</button>
  <button id="mBuyNow" class="bg-green-600 w-full p-2 rounded">Buy Now</button>
 </div>
</div>

<div id="toast" class="toast">Done</div>

<script>
// ===== ADMIN DATA =====
let adminProducts = JSON.parse(localStorage.getItem("products")) || [];
let discount = +localStorage.getItem("discount") || 0;
let couponData = JSON.parse(localStorage.getItem("coupon")) || null;
let appliedCoupon = 0;

// Convert admin products to games
let games = adminProducts.filter(p=>p.show).map(p=>({
 id:p.id,
 title:p.title,
 price:p.price,
 img:p.img,
 video:p.video||"",
 desc:p.desc||"",
 platform:"Admin",
 genre:"Game"
}));

if(!games.length){
 games=[{id:1,title:"Demo Game",price:999,img:"https://picsum.photos/400",video:"",desc:"Demo product"}];
}

// ===== STATE =====
let cart = JSON.parse(localStorage.getItem("brahmastra_cart")) || [];

// ===== PRICE =====
function finalPrice(p){
 let x=p.price;
 if(discount) x-=x*discount/100;
 if(appliedCoupon) x-=x*appliedCoupon/100;
 return Math.round(x);
}

// ===== RENDER =====
function renderGames(){
 let s=searchInput.value.toLowerCase();
 let f=games.filter(g=>g.title.toLowerCase().includes(s));
 gamesGrid.innerHTML=f.map(g=>{
  let p=finalPrice(g);
  return `
  <div class="glass p-3 rounded-xl card-hover">
   <img src="${g.img}" class="h-36 w-full object-cover rounded mb-2">
   <b class="text-sm">${g.title}</b>
   <p class="text-green-400 font-bold">₹${p}</p>
   <button onclick="addToCart(${g.id})" class="bg-purple-600 w-full mt-2 p-2 rounded">Add</button>
   <button onclick="openModal(${g.id})" class="w-full text-sm text-gray-400 mt-1">View</button>
  </div>`;
 }).join("");
}

// ===== CART =====
function addToCart(id){
 let g=games.find(x=>x.id===id);
 let i=cart.find(x=>x.id===id);
 if(i) i.qty++;
 else cart.push({...g,qty:1});
 saveCart();
 showToast("Added to cart");
}
function removeFromCart(id){
 cart=cart.filter(x=>x.id!==id);
 saveCart();
}
function saveCart(){
 localStorage.setItem("brahmastra_cart",JSON.stringify(cart));
 updateCartUI();
}
function updateCartUI(){
 cartCount.innerText=cart.length;
 let t=0;
 cartItems.innerHTML=cart.length?cart.map(i=>{
  let p=finalPrice(i); t+=p*i.qty;
  return `
  <div class="flex justify-between">
   <span>${i.title} × ${i.qty}</span>
   <span>₹${p*i.qty}</span>
   <button onclick="removeFromCart(${i.id})">❌</button>
  </div>`;
 }).join(""):"Cart Empty";
 cartTotal.innerText="₹"+t;
}

// ===== COUPON =====
function applyCoupon(){
 if(!couponData) return showToast("No coupon active");
 if(couponInput.value===couponData.code){
  appliedCoupon=couponData.off;
  showToast("Coupon Applied");
  updateCartUI();
 }else showToast("Invalid Coupon");
}

// ===== MODAL =====
function openModal(id){
 let g=games.find(x=>x.id===id);
 mTitle.innerText=g.title;
 mDesc.innerText=g.desc;
 mPrice.innerText="₹"+finalPrice(g);
 mVideo.src=g.video||"";
 mAddToCart.onclick=()=>{addToCart(id);closeModal();}
 mBuyNow.onclick=()=>{
  let msg=`I want to buy ${g.title} for ₹${finalPrice(g)}`;
  window.open("https://wa.me/919313339081?text="+encodeURIComponent(msg));
 }
 gameModal.classList.remove("hidden");
}
function closeModal(){
 gameModal.classList.add("hidden");
 mVideo.src="";
}

// ===== CART DRAWER =====
function toggleCart(){
 cartDrawer.style.transform = cartDrawer.style.transform==="translateX(0%)"?"translateX(100%)":"translateX(0%)";
}

// ===== TOAST =====
function showToast(t){
 toast.innerText=t;
 toast.classList.add("show");
 setTimeout(()=>toast.classList.remove("show"),2000);
}

// ===== SLIDER =====
let si=0;
setInterval(()=>{
 let s=document.querySelectorAll(".slide");
 s[si].classList.remove("active");
 si=(si+1)%s.length;
 s[si].classList.add("active");
},4000);

// INIT
renderGames();
updateCartUI();
</script>
</body>
</html>
